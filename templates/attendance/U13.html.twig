{% extends 'base.html.twig' %}

{% block title %}Page d'appel - U13
{% endblock %}

{% block stylesheet %}
	<style></style>
{% endblock %}

{% block body %}
	<link href="/css/attendance.css" rel="stylesheet"/>

	<style>
		img {
			filter: grayscale(100%) brightness(50%);
		}
	</style>

	<div class="col-lg-8 mx-auto p-5 py-md-5">
		<div class="mt-3 text-center">
			<h1 class="h1 mb-2">Page d'appel - U13</h1>
		</div>

		<div class="row row-cols-2 row-cols-md-2 row-cols-lg-4 g-4 pt-5">
			{% for user in users %}
				<div class="col">
					<div class="img card-attendance-u zoom" data-user-id="{{ user.id }}">
						<div class="abs present"><img src="/images/arthur-delacour.png" class="card-img-top" alt="..."></div>
						<div class="card-body">
							<h5 class="card-title text-center pt-1">{{ user.firstName }}
								{{ user.lastName }}</h5>
						</div>
					</div>
				</div>
			{% endfor %}
		</div>

		<div class="g-4 pt-5 text-center">
			<a class="btn btn-primary" id="finaliserAppel">Finaliser l'appel</a>
		</div>
	</div>

	<script>
		// JavaScript to add click event listeners to each abs
document.addEventListener('DOMContentLoaded', function () {
const abss = document.querySelectorAll('.abs');
const selectedUserIds = [];

abss.forEach(abs => {
selectedUserIds.push(abs.closest('.img').getAttribute('data-user-id'));
abs.addEventListener('click', function () { // Toggle the 'present' class to change the color
abs.classList.toggle('present');

// Update the selectedUserIds array
if (abs.classList.contains('present')) {
selectedUserIds.push(abs.closest('.img').getAttribute('data-user-id'));
} else {
const index = selectedUserIds.indexOf(abs.closest('.img').getAttribute('data-user-id'));
if (index !== -1) {
selectedUserIds.splice(index, 1);
}
}
});
});

// Function to finalize attendance and send a POST request
function finalizeAttendanceAndRedirect() { // Send a POST request to update matches_played_u10
fetch('{{ path('update_matches_played_u10') }}', {
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify(
{selectedUserIds: selectedUserIds}
)
}).then(response => {
if (response.ok) {
alert('Appel effectué avec succès!');
// Redirect to the desired route after the action is completed
window.location.href = '{{ path('app_attendance') }}';
} else {
alert('Erreur, l\'appel n\'a pas pu être effectué !');
}
});
}

// Attach the finalizeAttendanceAndRedirect function to the button click event
document.getElementById('finaliserAppel').addEventListener('click', finalizeAttendanceAndRedirect);
});
	</script>
{% endblock %}