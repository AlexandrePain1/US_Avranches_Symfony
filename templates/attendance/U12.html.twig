{% extends 'base.html.twig' %}

{% block title %}Page d'appel - U12
{% endblock %}

{% block stylesheet %}
	<style></style>
{% endblock %}

{% block body %}
	<link href="/css/attendance.css" rel="stylesheet"/>

	<style>
		img {
			filter: grayscale(100%) brightness(50%);
		}
	</style>

	<div class="col-lg-8 mx-auto p-5 py-md-5">
		<div class="mt-3 text-center">
			<h1 class="h1 mb-2">Page d'appel - U12</h1>
		</div>

		<div class="row row-cols-2 row-cols-md-2 row-cols-lg-4 g-4 pt-5">
			{% for user in users %}
				<div class="col">
					<div class="img" data-user-id="{{ user.id }}">
						<div class="abs present"><img src="/images/arthur-delacour.png" class="card-img-top zoom" alt="..."></div>
						<div class="card-body">
							<p class="card-text text-center">{{ user.firstName }}
								{{ user.lastName }}
								({{ user.getCategory }})
								<br>
								{{ user.dateNaissance|date('Y') }}
							</p>
						</div>
					</div>
				</div>
			{% endfor %}
		</div>

		<div class="g-4 pt-5 text-center">
			<button class="btn btn-primary" id="finaliserAppel" action="{{ path('update_matches_played_u12') }}">Finaliser l'appel</button>
		</div>
	</div>

	<script>
		// JavaScript to add click event listeners to each abs
document.addEventListener('DOMContentLoaded', function () {
const abss = document.querySelectorAll('.abs');
const selectedUserIds = [];

abss.forEach(abs => {
selectedUserIds.push(abs.closest('.img').getAttribute('data-user-id'));
abs.addEventListener('click', function () { // Toggle the 'present' class to change the color
abs.classList.toggle('present')

// Update the selectedUserIds array
if (abs.classList.contains('present')) {
selectedUserIds.push(abs.closest('.img').getAttribute('data-user-id'));
} else {
const index = selectedUserIds.indexOf(abs.closest('.img').getAttribute('data-user-id'));
if (index !== -1) {
selectedUserIds.splice(index, 1);
}
}
});
});

// Function to finalize attendance and send a POST request
function finalizeAttendance() { // Send a POST request to update matches_played_u12
fetch('{{ path('update_matches_played_u12') }}', {
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify(
{selectedUserIds: selectedUserIds}
)
}).then(response => { // console.log(response.body);
if (response.ok) { // Handle a successful response (you can customize this based on your needs).
alert('Appel effectué avec succès !');

} else { // Handle errors or other responses.
alert('Erreur, l\'appel n\'a pas pu être effectué !');
}
});
}

// Attach the finalizeAttendance function to the button click event
document.getElementById('finaliserAppel').addEventListener('click', finalizeAttendance);
});
	</script>

{% endblock %}

