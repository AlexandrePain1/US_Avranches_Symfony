{% extends 'base.html.twig' %}

{% block title %}Page d'appel - {{ category|upper }}
{% endblock %}

{% block body %}
<link href="/css/attendance.css" rel="stylesheet"/>
    <style>
        img {
            filter: grayscale(100%) brightness(50%); 
        }
    </style>

    <div class="col-lg-8 mx-auto p-5 py-md-5">
        <div class="mt-3 text-center">
            <h1 class="h1 mb-2 display-4">Page d'appel - {{ category|upper }}</h1>
        </div>

        <div class="row row-cols-2 row-cols-md-2 row-cols-lg-4 g-4 pt-5">
            {% for user in users %}
                <div class="col">
                    <div class="img card-attendance-u zoom" data-user-id="{{ user.id }}">
                        <div class="abs present"><img src="/images/arthur-delacour.png" class="card-img-top" alt="..."></div>
                        <div class="card-body">
                            <h5 class="card-title text-center pt-1">{{ user.firstName }} {{ user.lastName }}</h5>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <div class="g-4 pt-5 row">
            <div class="col text-end" style="text-align: start;">
                <a class="btn btn-success" id="finaliserAppel">Finaliser l'appel</a>
            </div>
            <div class="col">
                <a class="btn btn-danger" href="{{ path('app_attendance', {'category': category}) }}">Annuler l'appel</a>
            </div>
        </div>
    </div>

    <script>
        // JavaScript to add click event listeners to each abs
        document.addEventListener('DOMContentLoaded', function () {
            const abss = document.querySelectorAll('.abs');
            const selectedUserIds = [];

            abss.forEach(abs => {
                selectedUserIds.push(abs.closest('.img').getAttribute('data-user-id'));
                abs.addEventListener('click', function () { // Toggle the 'present' class to change the color and selectedUserIds
                    abs.classList.toggle('present');

                    // Update the selectedUserIds array
                    if (abs.classList.contains('present')) {
                        selectedUserIds.push(abs.closest('.img').getAttribute('data-user-id'));
                    } else {
                        const index = selectedUserIds.indexOf(abs.closest('.img').getAttribute('data-user-id'));
                        if (index !== -1) {
                            selectedUserIds.splice(index, 1);
                        }
                    }
                });
            });
        });
    </script>
{% endblock %}
